
rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Regla per defecte: denegar tot l'accés.
    match /{document=**} {
      allow read, write: if false;
    }

    // Permet als usuaris autenticats llegir i escriure les seves accions.
    match /actions/{actionId} {
      allow read, write: if request.auth != null;
    }

    // Les dades mestres es poden llegir públicament, però només les poden escriure usuaris autenticats
    // (en un futur, es podria restringir a rols d'administrador).
    match /actionTypes/{typeId} {
      allow read: if true;
      allow write: if request.auth != null;
    }

    match /categories/{categoryId} {
      allow read: if true;
      allow write: if request.auth != null;
    }

    match /subcategories/{subcategoryId} {
      allow read: if true;
      allow write: if request.auth != null;
    }

    match /affectedAreas/{areaId} {
      allow read: if true;
      allow write: if request.auth != null;
    }

    // La galeria de prompts es pot llegir públicament.
    match /prompt_gallery/{promptId} {
      allow read: if true;
      allow write: if request.auth != null;
    }
    
    // La configuració de l'aplicació (prompts d'IA) es pot llegir públicament.
    match /app_settings/{settingId} {
        allow read: if true;
        allow write: if request.auth != null;
    }
  }
}
